{
    "dockerfile": [
      {
        "instructions": [
          {
            "from": ["cgr.dev/chainguard/clang:latest As builder"]
          },
          {
            "env": [
              "APP_HOME=/app"
            ]
          },
          {
            "run": [
              "apt-get update",
              "apt-get install -y gcc",
              "apt-get clean",
              "useradd -m -s /bin/bash -d $APP_HOME myappuser"
            ]
          },
          {
            "workdir": "$APP_HOME"
          },
          {
            "copy": [
              "src/ $APP_HOME/src/",
              "Makefile $APP_HOME/"
            ]
          },
          {
            "run": [
              "make -C $APP_HOME"
            ]
          }
        ]
      },
      {
        "stage": "1",
        "instructions": [
          {
            "from": "cgr.dev/chainguard/static:latest"
          },
          {
            "env": [
              "APP_USER=myappuser",
              "APP_HOME=/app"
            ]
          },
          {
            "run": [
              "useradd -m -s /bin/bash -d $APP_HOME $APP_USER"
            ]
          },
          {
            "workdir": "$APP_HOME"
          },
          {
            "copy": [
              "--from=builder $APP_HOME/src/myapp $APP_HOME/src/myapp"
            ]
          },
          {
            "user": "$APP_USER"
          },
          {
            "cmd": [
              "./src/myapp"
            ]
          }
        ]
      }
    ]
  }